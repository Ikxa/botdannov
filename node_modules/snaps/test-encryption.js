require('traceur/bin/traceur-runtime');
var encrypt = require('./lib/encryption').encrypt;
var fancyEncrypt = require('./lib/encryption').fancyEncrypt;
var fs = require('fs');

var stream = fs.createReadStream('./test/stubs/image-data');
encrypt(stream).then(function(encryptedStream) {
  var output = new Buffer(0);
  encryptedStream.on('data', function(data) {
    output = Buffer.concat([output, data]);
  });
  return encryptedStream.on('end', function() {
    fs.writeFileSync('./blah', output);
  });
}).then(function() {
  console.log("all done with old method");
});

stream = fs.createReadStream('./test/stubs/image-data');
fancyEncrypt(stream).then(function(encryptedStream) {
  var output = new Buffer(0);
  encryptedStream.on('data', function(data) {
    output = Buffer.concat([output, data]);
  });
  return encryptedStream.on('end', function() {
    fs.writeFileSync('./blah2', output);
  });
}).then(function() {
  console.log("all done with new method");
}).catch(function(err) {
  console.log(err);
});
